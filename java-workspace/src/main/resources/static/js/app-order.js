(window.webpackJsonp=window.webpackJsonp||[]).push([[3],{131:function(t,e,a){"use strict";var n=a(35);a.n(n).a},132:function(t,e,a){"use strict";var n=a(36);a.n(n).a},35:function(t,e,a){},36:function(t,e,a){},95:function(t,e,a){"use strict";function n(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"order-editor"},[e.loading?n("Spin",{attrs:{fix:""}},[e._v("加载中...")]):e._e(),e._v(" "),n("Card",{staticClass:"customer-info",attrs:{title:"客户信息"}},[n("Form",{attrs:{model:e.customer,"label-width":120}},[n("Row",[n("Col",{attrs:{span:"6"}},[n("FormItem",{attrs:{label:"名称："}},[e._v(e._s(e.customer.name))])],1),e._v(" "),n("Col",{attrs:{span:"6"}},[n("FormItem",{attrs:{label:"昵称："}},[e._v(e._s(e.customer.nick))])],1),e._v(" "),n("Col",{attrs:{span:"6"}},[n("FormItem",{attrs:{label:"旺旺："}},[e._v(e._s(e.customer.wangwang))])],1),e._v(" "),n("Col",{attrs:{span:"6"}},[n("FormItem",{attrs:{label:"地域："}},[e._v(e._s(e.customer.region))])],1)],1),e._v(" "),n("Row",[n("Col",{attrs:{span:"6"}},[n("FormItem",{attrs:{label:"手机："}},[e._v(e._s(e.customer.phone))])],1),e._v(" "),n("Col",{attrs:{span:"6"}},[n("FormItem",{attrs:{label:"微信："}},[e._v(e._s(e.customer.wechat))])],1),e._v(" "),n("Col",{attrs:{span:"6"}},[n("FormItem",{attrs:{label:"QQ："}},[e._v(e._s(e.customer.qq))])],1)],1),e._v(" "),n("Row",[n("Col",{attrs:{span:"24"}},[n("FormItem",{attrs:{label:"备注内容："}},[e._v(e._s(e.customer.remark))])],1)],1)],1)],1),e._v(" "),n("Divider"),e._v(" "),n("Form",{ref:"form",attrs:{model:e.form,"label-width":120}},[n("Row",[n("Col",{attrs:{span:"12"}},[n("FormItem",{attrs:{label:"订单总金额：",prop:"amount",rules:e.rules.amount}},[n("InputNumber",{staticStyle:{"min-width":"20em"},attrs:{placeholder:"请输入订单总金额",min:0,max:1e20,step:.1,formatter:function(t){return("$ "+t).replace(/\B(?=(\d{3})+(?!\d))/g,",")},parser:function(t){return t.replace(/\$\s?|(,*)/g,"")}},model:{value:e.form.amount,callback:function(t){e.$set(e.form,"amount",t)},expression:"form.amount"}})],1)],1),e._v(" "),n("Col",{attrs:{span:"12"}},[n("FormItem",{attrs:{label:"成交时间：",prop:"dealTime",rules:e.rules.dealTime}},[n("DatePicker",{attrs:{type:"datetime",editable:!1,clearable:!1,placeholder:"请选择成交时间"},model:{value:e.form.dealTime,callback:function(t){e.$set(e.form,"dealTime",t)},expression:"form.dealTime"}})],1)],1)],1),e._v(" "),n("Collapse",{staticClass:"order-payment-collapse",attrs:{value:e.collapses}},e._l(e.form.payments,function(a,t){return n("Panel",{key:t},[1<e.collapses.length?n("span",[e._v("第 "+e._s(t+1)+" 笔")]):e._e(),e._v(" "),n("span",[e._v("付款信息")]),e._v(" "),n("Card",{attrs:{slot:"content"},slot:"content"},[n("Row",[n("Col",{attrs:{span:"12"}},[n("FormItem",{attrs:{label:"付款金额：",prop:"payments["+t+"].amount",rules:e.rules.payment.amount}},[n("InputNumber",{staticStyle:{"min-width":"20em"},attrs:{placeholder:"请输入付款金额",min:0,max:1e20,step:.1,formatter:function(t){return("$ "+t).replace(/\B(?=(\d{3})+(?!\d))/g,",")},parser:function(t){return t.replace(/\$\s?|(,*)/g,"")}},model:{value:a.amount,callback:function(t){e.$set(a,"amount",t)},expression:"p.amount"}})],1)],1),e._v(" "),n("Col",{attrs:{span:"12"}},[n("FormItem",{attrs:{label:"付款方式：",prop:"payments["+t+"].paymentWay",rules:e.rules.payment.paymentWay}},[n("Select",{attrs:{filterable:"","allow-create":""},on:{"on-create":e.handlePaymentWayCreated},model:{value:a.paymentWay,callback:function(t){e.$set(a,"paymentWay",t)},expression:"p.paymentWay"}},e._l(e.payments,function(t){return n("Option",{key:t,attrs:{value:t}},[e._v(e._s(t))])}),1)],1)],1)],1),e._v(" "),n("Row",[n("Col",{attrs:{span:"12"}},[n("FormItem",{attrs:{label:"付款账号：",prop:"payments["+t+"].paymentAccount",rules:e.rules.payment.paymentAccount}},[n("Input",{attrs:{laceholder:"请输入付款账号"},model:{value:a.paymentAccount,callback:function(t){e.$set(a,"paymentAccount",t)},expression:"p.paymentAccount"}})],1)],1),e._v(" "),n("Col",{attrs:{span:"12"}},[n("FormItem",{attrs:{label:"付款时间：",prop:"payments["+t+"].paymentTime",rules:e.rules.payment.paymentTime}},[n("DatePicker",{attrs:{type:"datetime",editable:!1,clearable:!1,placeholder:"请选择付款时间"},model:{value:a.paymentTime,callback:function(t){e.$set(a,"paymentTime",t)},expression:"p.paymentTime"}})],1)],1)],1),e._v(" "),n("Row",[n("Col",{attrs:{span:"24"}},[n("FormItem",{attrs:{label:"付款凭证：",prop:"payments["+t+"].paymentProof",rules:e.rules.payment.paymentProof}},[n("div",{staticClass:"order-payment-item"},[n("div",{staticClass:"order-payment-container"},[n("img",{directives:[{name:"show",rawName:"v-show",value:a.paymentProof,expression:"p.paymentProof"}],attrs:{src:a.paymentProof}}),e._v(" "),n("div",{staticClass:"order-payment-container-cover"},[n("Icon",{attrs:{type:"ios-eye-outline"},nativeOn:{click:function(t){return e.handlePaymentView(a.paymentProof)}}}),e._v(" "),n("Icon",{attrs:{type:"ios-trash-outline"},nativeOn:{click:function(t){return a.remove(t)}}})],1)]),e._v(" "),n("Tabs",{staticClass:"order-payment-tabs",attrs:{value:"local"}},[n("TabPane",{attrs:{label:"本地",name:"local"}},[n("Upload",{staticStyle:{display:"inline-block",width:"100%"},attrs:{format:a.format,"show-upload-list":!1,"max-size":10240,action:"/fs/uploader/image","on-success":function(t,e){return a.success(t,e)},"on-format-error":e.handlePaymentFormatError,"on-exceeded-size":e.handlePaymentExceededSize}},[n("Button",{attrs:{icon:"ios-cloud-upload-outline"}},[e._v("选择本地文件")])],1)],1),e._v(" "),n("TabPane",{attrs:{label:"网络",name:"net"}},[n("Input",{attrs:{laceholder:"请输入图片的网络地址"},model:{value:a.paymentProof,callback:function(t){e.$set(a,"paymentProof",t)},expression:"p.paymentProof"}})],1)],1)],1)])],1)],1)],1)],1)}),1),e._v(" "),n("FormItem",{attrs:{label:"已付总金额：",prop:"paidAmount",rules:e.rules.paidAmount}},[n("InputNumber",{staticStyle:{"min-width":"20em"},attrs:{value:e.paidAmount,readonly:"",formatter:function(t){return("$ "+t).replace(/\B(?=(\d{3})+(?!\d))/g,",")},parser:function(t){return t.replace(/\$\s?|(,*)/g,"")}}}),e._v(" "),n("Tooltip",{attrs:{content:"点击此处新增一笔新付款信息",placement:"top"}},[n("Badge",{attrs:{count:e.form.payments.length}},[n("Button",{attrs:{icon:"md-add"},on:{click:e.handlePaymentAdd}})],1)],1)],1),e._v(" "),n("FormItem",{staticStyle:{"margin-top":"20px"},attrs:{label:"备注内容："}},[n("Input",{attrs:{type:"textarea",autosize:{minRows:5,maxRows:10},placeholder:"请输入备注内容"},model:{value:e.form.remark,callback:function(t){e.$set(e.form,"remark",t)},expression:"form.remark"}})],1),e._v(" "),n("FormItem",{staticStyle:{"margin-top":"20px"}},[n("Button",{attrs:{type:"primary",size:"large",loading:e.padding},on:{click:e.submit}},[e._v("保存")])],1)],1),e._v(" "),n("Modal",{attrs:{title:"预览付款凭证"},model:{value:e.modal.visible,callback:function(t){e.$set(e.modal,"visible",t)},expression:"modal.visible"}},[e.modal.visible?n("img",{staticStyle:{width:"100%"},attrs:{src:e.modal.src}}):e._e()])],1)}n._withStripped=!0;var r=a(5),o=a.n(r),s=a(81),i=a.n(s),l=a(82),c=(a.n(l)()(m,[{key:"success",value:function(t){if(t instanceof Array&&0<t.length){var e=t[0];e&&e.url&&(this.uploader=e,this.paymentProof=e.url)}}},{key:"remove",value:function(){this.paymentProof=""}},{key:"format",get:function(){return["jpg","jgep","png"]}}]),m);function m(){i()(this,m),this.amount=0,this.paymentWay="",this.paymentTime="",this.paymentProof="",this.paymentAccount="",this.uploader={}}var u={name:"OrderEditor",data:function(){var o=this;return{customer:{},form:{customerId:0,amount:0,dealTime:"",remark:"",payments:[],paidAmount:0},rules:{amount:[{required:!0,message:"订单总金额不允许为空"},{validator:function(t,e,a){0<=e?a():a(new Error("订单总金额不允许输入负数"))}}],dealTime:[{required:!0,message:"请选择成交时间"}],payment:{amount:[{required:!0,message:"请输入付款金额"}],paymentWay:[{required:!0,message:"请选择付款方式"}],paymentTime:[{required:!0,message:"请选择付款时间"}],paymentProof:[{required:!0,message:"上传凭证不允许为空，请上传付款凭证的图片，或者录入网络图片地址"}],paymentAccount:[{required:!0,message:"请输入付款账号"}]},paidAmount:[{validator:function(t,e,a){var n=o.form.amount;if(0<=e){var r=e-n;0<r?a(new Error("订单实付金额大于订单总金额，相差 "+r+" 元，请检查您输入的数据")):a()}else a(new Error("订单总金额不允许输入负数"))}}]},payments:["信用卡","储蓄卡","支付宝","QQ支付","微信支付","苹果支付","现金支付"],modal:{src:"",visible:!1},padding:!1,loading:!1}},computed:{cid:{get:function(){var t=this.$route.params.customer,e=this.form.customer;return e||t}},collapses:{get:function(){for(var t=[],e=0;e<this.form.payments.length;)t.push(e++);return t}},paidAmount:{get:function(){for(var t=0,e=this.form.payments,a=0;a<e.length;){var n=e[a];t+=n&&0<n.amount?n.amount:0,a++}return this.form.paidAmount=t}}},mounted:function(){if(!this.cid)return this.$Message.warning("请选择需要创建订单的客户对象！"),void this.$router.push({name:"CustomerList"});this.handlePaymentAdd(),this.load()},methods:{load:function(){var t=this;this.loading=!0;var r=this,e=[new o.a(function(n){API.getOrderPaymentWay().then(function(t){for(var e=t&&t.data instanceof Array?t.data:[],a=0;a<e.length;)r.handlePaymentWayCreated(e[a]),a++;n(!0)}).catch(function(){return n(!1)})}),new o.a(function(e){r.cid?API.getCustomer({id:r.cid}).then(function(t){r.customer=t&&t.data?t.data:{},e(!0)}).catch(function(t){r.$error(t),e(!1)}):e(!1)})];this.loading=!0,o.a.all(e).then(function(){return t.loading=!1})},handlePaymentAdd:function(){this.form.payments.push(new c)},handlePaymentWayCreated:function(t){(t?t+"":"").trim();t&&this.payments.indexOf(t)<0&&this.payments.push(t)},handlePaymentFormatError:function(t){this.$Notice.warning({title:"文件格式不正确",desc:"文件 "+t.name+" 的格式不正确，建议上传 png 文件"})},handlePaymentExceededSize:function(t){this.$Notice.warning({title:"超出文件上限",desc:"文件  "+t.name+" 过大，请选择不大于 10MB 的文件"})},handlePaymentView:function(t){t?(this.modal.src=t,this.modal.visible=!0):this.$Message.warning("暂无可预览的付款凭证，请上传付款凭证！")},submit:function(){var i=this;if(!this.padding){var l=this;l.$refs.form.validate(function(t){if(!0===t){i.paidAmount;var e=i.form,a=[],n={customerId:i.cid,amount:e.amount,remark:e.remark},r=0;for(e.dealTime instanceof Date&&(n.dealTime=e.dealTime.format("yyyy-MM-dd HH:mm:ss"));r<e.payments.length;){var o=e.payments[r],s={amount:o.amount,paymentWay:o.paymentWay,paymentProof:o.paymentProof,paymentAccount:o.paymentAccount};o.paymentTime instanceof Date&&(s.paymentTime=o.paymentTime.format("yyyy-MM-dd HH:mm:ss")),a.push(s),r++}a.length<1?l.$Message.error("请录入付款信息！"):(n.payments=a,l.padding=!0,API.postOrderSave(n).then(function(t){l.padding=!1}).catch(function(t){return l.$error(t,function(){l.padding=!1})}))}else l.$Message.error("请完善表单信息！")})}}}},d=(a(131),a(0)),p=Object(d.a)(u,n,[],!1,null,"f8035560",null);p.options.__file="src/views/order/OrderEditor.vue";e.a=p.exports},96:function(t,e,a){"use strict";function n(){var a=this,t=a.$createElement,n=a._self._c||t;return n("div",[n("div",{staticClass:"tool-bar"},[n("ButtonGroup",[n("Button",{attrs:{type:"info",icon:"md-add"},on:{click:a.handleDistribute}},[a._v("分配订单")]),a._v(" "),n("Button",{attrs:{icon:"md-cloud-download"},on:{click:function(t){a.exporter.visible=!0}}},[a._v("导出")])],1),a._v(" "),n("div",{staticClass:"tool-searcher"},[n("Input",{attrs:{search:"","enter-button":"搜索",placeholder:"请输入客户的名称、昵称、微信、电话等信息进行检索"},on:{"on-search":function(t){return a.load(1)}},model:{value:a.searcher.word,callback:function(t){a.$set(a.searcher,"word",t)},expression:"searcher.word"}})],1)],1),a._v(" "),n("Table",{ref:"table",attrs:{border:"","context-menu":"","show-context-menu":"",columns:a.table.columns,data:a.table.data,loading:a.loading},on:{"on-contextmenu":function(t){return a.table.crow=t},"on-selection-change":function(t){return a.table.selection=t}}},[n("template",{slot:"footer"},[n("Page",{attrs:{total:a.pager.total,"page-size":a.pager.size,current:a.pager.current,size:"small","show-total":"","show-sizer":""},on:{"on-change":a.handleTablePageChange,"on-page-size-change":a.handleTablePageSizeChange}})],1),a._v(" "),n("template",{slot:"contextMenu"},[n("DropdownItem",{nativeOn:{click:function(t){return a.handleContextMenuDistribute(t)}}},[a._v("分配订单")]),a._v(" "),n("DropdownItem",{nativeOn:{click:function(t){return a.handleContextMenuView(t)}}},[a._v("查看详情")])],1)],2),a._v(" "),n("Modal",{attrs:{title:"导出选项","class-name":"vertical-center-modal"},model:{value:a.exporter.visible,callback:function(t){a.$set(a.exporter,"visible",t)},expression:"exporter.visible"}},[n("RadioGroup",{model:{value:a.exporter.option,callback:function(t){a.$set(a.exporter,"option",t)},expression:"exporter.option"}},[n("Radio",{attrs:{label:"current"}},[a._v("当前页的列表")]),a._v(" "),n("Radio",{attrs:{label:"whole"}},[a._v("完整的列表")])],1),a._v(" "),n("div",{staticClass:"modal-footer",attrs:{slot:"footer"},slot:"footer"},[n("Button",{attrs:{type:"primary"},on:{click:a.handleExport}},[a._v("确认")])],1)],1),a._v(" "),n("Modal",{attrs:{title:"订单分配","class-name":"vertical-center-modal"},model:{value:a.allocator.visible,callback:function(t){a.$set(a.allocator,"visible",t)},expression:"allocator.visible"}},[n("div",{staticClass:"modal-body"},[a.allocator.loading?n("Spin",{attrs:{fix:""}},[a._v("加载中...")]):n("AutoComplete",{staticClass:"modal-auto-complete",attrs:{icon:"ios-search",placeholder:"请输入姓名"},model:{value:a.allocated,callback:function(t){a.allocated=t},expression:"allocated"}},a._l(a.allocator.options,function(t,e){return n("div",{key:e,staticClass:"demo-auto-complete-item"},[n("div",{staticClass:"demo-auto-complete-group"},[n("span",[a._v(a._s(t.title))])]),a._v(" "),a._l(t.children,function(t){return n("Option",{key:t.title,attrs:{value:t}},[n("span",{staticClass:"demo-auto-complete-title"},[a._v(a._s(t.title))])])})],2)}),0)],1),a._v(" "),n("div",{staticClass:"modal-footer",attrs:{slot:"footer"},slot:"footer"},[n("Button",{attrs:{type:"primary",loading:a.allocator.pending},on:{click:a.handleAllocate}},[a._v("确认")])],1)])],1)}n._withStripped=!0;var r={data:function(){return{loading:!1,searcher:{word:""},table:{columns:[{type:"selection",width:60,align:"center"},{width:70,type:"index",title:"序号",align:"center"},{width:120,title:"客户名称",key:"customerName",align:"center"},{width:120,title:"订单总金额",key:"amount",align:"center"},{width:120,title:"已付总金额",key:"amount",align:"center"},{width:170,title:"成交时间",key:"dealTime",align:"center"},{width:150,title:"订单创建人",key:"creatorName",align:"center"},{width:150,title:"订单创建人部门",key:"creatorDepartmentName",align:"center"},{width:150,title:"订单执行人",key:"executorName",align:"center"},{width:150,title:"订单执行人部门",key:"executorDepartmentName",align:"center"},{width:120,title:"备注",key:"remark"}],data:[],crow:{},selection:[]},pager:{current:1,size:10,total:0},exporter:{visible:!1,option:"current"},allocator:{loading:!1,numbers:[],title:"",value:"",options:[],visible:!1}}},computed:{allocated:{get:function(){return this.allocator.title?this.allocator.title:""},set:function(t){t&&t.value&&t.title&&(this.allocator.value=t.value,this.allocator.title=t.title)}}},watch:{"allocator.visible":{handler:function(t){var e=this;1==t&&this.allocator.options.length<1&&(this.allocator.loading=!0,API.getUserAutoCompleteOptions().then(function(t){e.allocator.options=t&&Array.isArray(t.data)?t.data:[],e.allocator.loading=!1}).catch(function(){return e.allocator.loading=!1}))}}},mounted:function(){this.load()},methods:{load:function(t,e){var a=this;if(!this.loading){t=0<t?t:this.pager.number,e=0<e?e:this.pager.size;var n=this;n.loading=!0,API.getOrderList({number:t,size:e,keyword:this.searcher.word}).then(function(t){var e=t&&t.data?t.data:{};n.pager.size=e.size,n.pager.total=e.total,n.pager.current=e.number,n.table.data=e.rows instanceof Array?e.rows:[],n.loading=!1}).catch(function(t){return a.$error(t,a.loading=!1)})}},handleTablePageChange:function(t){this.load(t,this.pager.size)},handleTablePageSizeChange:function(t){this.load(this.pager.current,t)},handleExport:function(){if("current"==this.exporter.option)return this.$refs.table.exportCsv({filename:(new Date).format("订单列表-yyyyMMddHHmmss-")+this.pager.current}),void(this.exporter.visible=!1);this.$Message.info("订单数据导出功能暂未开放!")},handleAllocate:function(){var e=this,t=this.allocator.numbers,a=parseInt(this.allocator.value);t.length<1?this.$Message.error("请选择需要分配的订单"):0<a?(this.allocator.pending=!0,API.postOrderDistribute({numbers:t.join(","),executor:a}).then(function(){e.$Message.success("分配成功"),e.load(),e.allocator.pending=!1,e.allocator.visible=!1}).catch(function(t){return e.$error(t,function(){e.allocator.pending=!1})})):this.$Message.error("请选择分配的对象")},handleDistribute:function(){for(var t=[],e=0,a=this.table.selection;e<a.length;){var n=a[e];n&&n.number&&t.push(n.number),e++}t.length<1?this.$Message.error("请选择需要分配的订单"):(this.allocator.numbers=t,this.allocator.visible=!0)},handleContextMenuDistribute:function(){this.allocator.numbers=[this.table.crow.number],this.allocator.visible=!0},handleContextMenuView:function(){}}},o=(a(132),a(0)),s=Object(o.a)(r,n,[],!1,null,"08fb5ac1",null);s.options.__file="src/views/order/OrderList.vue";e.a=s.exports}}]);