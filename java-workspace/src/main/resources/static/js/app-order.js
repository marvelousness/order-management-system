(window.webpackJsonp=window.webpackJsonp||[]).push([[3],{128:function(t,e,a){"use strict";var n=a(34);a.n(n).a},34:function(t,e,a){},93:function(t,e,a){"use strict";function n(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"order-editor"},[e.loading?n("Spin",{attrs:{fix:""}},[e._v("加载中...")]):e._e(),e._v(" "),n("Card",{staticClass:"customer-info",attrs:{title:"客户信息"}},[n("Form",{attrs:{model:e.customer,"label-width":120}},[n("Row",[n("Col",{attrs:{span:"6"}},[n("FormItem",{attrs:{label:"名称："}},[e._v(e._s(e.customer.name))])],1),e._v(" "),n("Col",{attrs:{span:"6"}},[n("FormItem",{attrs:{label:"昵称："}},[e._v(e._s(e.customer.nick))])],1),e._v(" "),n("Col",{attrs:{span:"6"}},[n("FormItem",{attrs:{label:"旺旺："}},[e._v(e._s(e.customer.wangwang))])],1),e._v(" "),n("Col",{attrs:{span:"6"}},[n("FormItem",{attrs:{label:"地域："}},[e._v(e._s(e.customer.region))])],1)],1),e._v(" "),n("Row",[n("Col",{attrs:{span:"6"}},[n("FormItem",{attrs:{label:"手机："}},[e._v(e._s(e.customer.phone))])],1),e._v(" "),n("Col",{attrs:{span:"6"}},[n("FormItem",{attrs:{label:"微信："}},[e._v(e._s(e.customer.wechat))])],1),e._v(" "),n("Col",{attrs:{span:"6"}},[n("FormItem",{attrs:{label:"QQ："}},[e._v(e._s(e.customer.qq))])],1)],1),e._v(" "),n("Row",[n("Col",{attrs:{span:"24"}},[n("FormItem",{attrs:{label:"备注内容："}},[e._v(e._s(e.customer.remark))])],1)],1)],1)],1),e._v(" "),n("Divider"),e._v(" "),n("Form",{ref:"form",attrs:{model:e.form,"label-width":120}},[n("Row",[n("Col",{attrs:{span:"12"}},[n("FormItem",{attrs:{label:"订单总金额：",prop:"amount",rules:e.rules.amount}},[n("InputNumber",{staticStyle:{"min-width":"20em"},attrs:{placeholder:"请输入订单总金额",min:0,max:1e20,step:.1,formatter:function(t){return("$ "+t).replace(/\B(?=(\d{3})+(?!\d))/g,",")},parser:function(t){return t.replace(/\$\s?|(,*)/g,"")}},model:{value:e.form.amount,callback:function(t){e.$set(e.form,"amount",t)},expression:"form.amount"}})],1)],1),e._v(" "),n("Col",{attrs:{span:"12"}},[n("FormItem",{attrs:{label:"成交时间：",prop:"dealTime",rules:e.rules.dealTime}},[n("DatePicker",{attrs:{type:"datetime",editable:!1,clearable:!1,placeholder:"请选择成交时间"},model:{value:e.form.dealTime,callback:function(t){e.$set(e.form,"dealTime",t)},expression:"form.dealTime"}})],1)],1)],1),e._v(" "),n("Collapse",{staticClass:"order-payment-collapse",attrs:{value:e.collapses}},e._l(e.form.payments,function(a,t){return n("Panel",{key:t},[1<e.collapses.length?n("span",[e._v("第 "+e._s(t+1)+" 笔")]):e._e(),e._v(" "),n("span",[e._v("付款信息")]),e._v(" "),n("Card",{attrs:{slot:"content"},slot:"content"},[n("Row",[n("Col",{attrs:{span:"12"}},[n("FormItem",{attrs:{label:"付款金额：",prop:"payments["+t+"].amount",rules:e.rules.payment.amount}},[n("InputNumber",{staticStyle:{"min-width":"20em"},attrs:{placeholder:"请输入付款金额",min:0,max:1e20,step:.1,formatter:function(t){return("$ "+t).replace(/\B(?=(\d{3})+(?!\d))/g,",")},parser:function(t){return t.replace(/\$\s?|(,*)/g,"")}},model:{value:a.amount,callback:function(t){e.$set(a,"amount",t)},expression:"p.amount"}})],1)],1),e._v(" "),n("Col",{attrs:{span:"12"}},[n("FormItem",{attrs:{label:"付款方式：",prop:"payments["+t+"].paymentWay",rules:e.rules.payment.paymentWay}},[n("Select",{attrs:{filterable:"","allow-create":""},on:{"on-create":e.handlePaymentWayCreated},model:{value:a.paymentWay,callback:function(t){e.$set(a,"paymentWay",t)},expression:"p.paymentWay"}},e._l(e.payments,function(t){return n("Option",{key:t,attrs:{value:t}},[e._v(e._s(t))])}),1)],1)],1)],1),e._v(" "),n("Row",[n("Col",{attrs:{span:"12"}},[n("FormItem",{attrs:{label:"付款账号：",prop:"payments["+t+"].paymentAccount",rules:e.rules.payment.paymentAccount}},[n("Input",{attrs:{laceholder:"请输入付款账号"},model:{value:a.paymentAccount,callback:function(t){e.$set(a,"paymentAccount",t)},expression:"p.paymentAccount"}})],1)],1),e._v(" "),n("Col",{attrs:{span:"12"}},[n("FormItem",{attrs:{label:"付款时间：",prop:"payments["+t+"].paymentTime",rules:e.rules.payment.paymentTime}},[n("DatePicker",{attrs:{type:"datetime",editable:!1,clearable:!1,placeholder:"请选择付款时间"},model:{value:a.paymentTime,callback:function(t){e.$set(a,"paymentTime",t)},expression:"p.paymentTime"}})],1)],1)],1),e._v(" "),n("Row",[n("Col",{attrs:{span:"24"}},[n("FormItem",{attrs:{label:"付款凭证：",prop:"payments["+t+"].paymentProof",rules:e.rules.payment.paymentProof}},[n("div",{staticClass:"order-payment-item"},[n("div",{staticClass:"order-payment-container"},[n("img",{directives:[{name:"show",rawName:"v-show",value:a.paymentProof,expression:"p.paymentProof"}],attrs:{src:a.paymentProof}}),e._v(" "),n("div",{staticClass:"order-payment-container-cover"},[n("Icon",{attrs:{type:"ios-eye-outline"},nativeOn:{click:function(t){return e.handlePaymentView(a.paymentProof)}}}),e._v(" "),n("Icon",{attrs:{type:"ios-trash-outline"},nativeOn:{click:function(t){return a.remove(t)}}})],1)]),e._v(" "),n("Tabs",{staticClass:"order-payment-tabs",attrs:{value:"local"}},[n("TabPane",{attrs:{label:"本地",name:"local"}},[n("Upload",{staticStyle:{display:"inline-block",width:"100%"},attrs:{format:a.format,"show-upload-list":!1,"max-size":10240,action:"/fs/uploader/image","on-success":function(t,e){return a.success(t,e)},"on-format-error":e.handlePaymentFormatError,"on-exceeded-size":e.handlePaymentExceededSize}},[n("Button",{attrs:{icon:"ios-cloud-upload-outline"}},[e._v("选择本地文件")])],1)],1),e._v(" "),n("TabPane",{attrs:{label:"网络",name:"net"}},[n("Input",{attrs:{laceholder:"请输入图片的网络地址"},model:{value:a.paymentProof,callback:function(t){e.$set(a,"paymentProof",t)},expression:"p.paymentProof"}})],1)],1)],1)])],1)],1)],1)],1)}),1),e._v(" "),n("FormItem",{attrs:{label:"已付总金额：",prop:"paidAmount",rules:e.rules.paidAmount}},[n("InputNumber",{staticStyle:{"min-width":"20em"},attrs:{value:e.paidAmount,readonly:"",formatter:function(t){return("$ "+t).replace(/\B(?=(\d{3})+(?!\d))/g,",")},parser:function(t){return t.replace(/\$\s?|(,*)/g,"")}}}),e._v(" "),n("Tooltip",{attrs:{content:"点击此处新增一笔新付款信息",placement:"top"}},[n("Badge",{attrs:{count:e.form.payments.length}},[n("Button",{attrs:{icon:"md-add"},on:{click:e.handlePaymentAdd}})],1)],1)],1),e._v(" "),n("FormItem",{staticStyle:{"margin-top":"20px"},attrs:{label:"备注内容："}},[n("Input",{attrs:{type:"textarea",autosize:{minRows:5,maxRows:10},placeholder:"请输入备注内容"},model:{value:e.form.remark,callback:function(t){e.$set(e.form,"remark",t)},expression:"form.remark"}})],1),e._v(" "),n("FormItem",{staticStyle:{"margin-top":"20px"}},[n("Button",{attrs:{type:"primary",size:"large",loading:e.padding},on:{click:e.submit}},[e._v("保存")])],1)],1),e._v(" "),n("Modal",{attrs:{title:"预览付款凭证"},model:{value:e.modal.visible,callback:function(t){e.$set(e.modal,"visible",t)},expression:"modal.visible"}},[e.modal.visible?n("img",{staticStyle:{width:"100%"},attrs:{src:e.modal.src}}):e._e()])],1)}n._withStripped=!0;var r=a(5),o=a.n(r),s=a(79),i=a.n(s),m=a(80),l=(a.n(m)()(u,[{key:"success",value:function(t){if(t instanceof Array&&0<t.length){var e=t[0];e&&e.url&&(this.uploader=e,this.paymentProof=e.url)}}},{key:"remove",value:function(){this.paymentProof=""}},{key:"format",get:function(){return["jpg","jgep","png"]}}]),u);function u(){i()(this,u),this.amount=0,this.paymentWay="",this.paymentTime="",this.paymentProof="",this.paymentAccount="",this.uploader={}}var c={name:"OrderEditor",data:function(){var o=this;return{customer:{},form:{customerId:0,amount:0,dealTime:"",remark:"",payments:[],paidAmount:0},rules:{amount:[{required:!0,message:"订单总金额不允许为空"},{validator:function(t,e,a){0<=e?a():a(new Error("订单总金额不允许输入负数"))}}],dealTime:[{required:!0,message:"请选择成交时间"}],payment:{amount:[{required:!0,message:"请输入付款金额"}],paymentWay:[{required:!0,message:"请选择付款方式"}],paymentTime:[{required:!0,message:"请选择付款时间"}],paymentProof:[{required:!0,message:"上传凭证不允许为空，请上传付款凭证的图片，或者录入网络图片地址"}],paymentAccount:[{required:!0,message:"请输入付款账号"}]},paidAmount:[{validator:function(t,e,a){var n=o.form.amount;if(0<=e){var r=e-n;0<r?a(new Error("订单实付金额大于订单总金额，相差 "+r+" 元，请检查您输入的数据")):a()}else a(new Error("订单总金额不允许输入负数"))}}]},payments:["信用卡","储蓄卡","支付宝","QQ支付","微信支付","苹果支付","现金支付"],modal:{src:"",visible:!1},padding:!1,loading:!1}},computed:{cid:{get:function(){var t=this.$route.params.customer,e=this.form.customer;return e||t}},collapses:{get:function(){for(var t=[],e=0;e<this.form.payments.length;)t.push(e++);return t}},paidAmount:{get:function(){for(var t=0,e=this.form.payments,a=0;a<e.length;){var n=e[a];t+=n&&0<n.amount?n.amount:0,a++}return this.form.paidAmount=t}}},mounted:function(){if(!this.cid)return this.$Message.warning("请选择需要船创建订单的客户对象！"),void this.$router.push({name:"CustomerList"});this.handlePaymentAdd(),this.load()},methods:{load:function(){var t=this;this.loading=!0;var r=this,e=[new o.a(function(n){API.postOrderPaymentWay().then(function(t){for(var e=t&&t.data instanceof Array?t.data:[],a=0;a<e.length;)r.handlePaymentWayCreated(e[a]),a++;n(!0)}).catch(function(){return n(!1)})}),new o.a(function(e){r.cid?API.getCustomer({id:r.cid}).then(function(t){r.customer=t&&t.data?t.data:{},e(!0)}).catch(function(t){r.$error(t),e(!1)}):e(!1)})];this.loading=!0,o.a.all(e).then(function(){return t.loading=!1})},handlePaymentAdd:function(){this.form.payments.push(new l)},handlePaymentWayCreated:function(t){(t?t+"":"").trim();t&&this.payments.indexOf(t)<0&&this.payments.push(t)},handlePaymentFormatError:function(t){this.$Notice.warning({title:"文件格式不正确",desc:"文件 "+t.name+" 的格式不正确，建议上传 png 文件"})},handlePaymentExceededSize:function(t){this.$Notice.warning({title:"超出文件上限",desc:"文件  "+t.name+" 过大，请选择不大于 10MB 的文件"})},handlePaymentView:function(t){t?(this.modal.src=t,this.modal.visible=!0):this.$Message.warning("暂无可预览的付款凭证，请上传付款凭证！")},submit:function(){var i=this;if(!this.padding){var m=this;m.$refs.form.validate(function(t){if(!0===t){i.paidAmount;var e=i.form,a=[],n={customerId:i.cid,amount:e.amount,remark:e.remark},r=0;for(e.dealTime instanceof Date&&(n.dealTime=e.dealTime.format("yyyy-MM-dd HH:mm:ss"));r<e.payments.length;){var o=e.payments[r],s={amount:o.amount,paymentWay:o.paymentWay,paymentProof:o.paymentProof,paymentAccount:o.paymentAccount};o.paymentTime instanceof Date&&(s.paymentTime=o.paymentTime.format("yyyy-MM-dd HH:mm:ss")),a.push(s),r++}a.length<1?m.$Message.error("请录入付款信息！"):(n.payments=a,m.padding=!0,API.postOrderSave(n).then(function(t){m.padding=!1}).catch(function(t){return m.$error(t,function(){m.padding=!1})}))}else m.$Message.error("请完善表单信息！")})}}}},p=(a(128),a(0)),d=Object(p.a)(c,n,[],!1,null,"f8035560",null);d.options.__file="src/views/order/OrderEditor.vue";e.a=d.exports},94:function(t,e,a){"use strict";function n(){var t=this.$createElement;return(this._self._c||t)("div",[this._v("\n    订单列表\n")])}n._withStripped=!0;var r={data:function(){return{loading:!1}},mounted:function(){this.load()},methods:{load:function(){var e=this;this.loading||(this.loading=!0,API.getDepartmentTree().then(function(t){e.loading=!1}).catch(function(t){return e.$error(t,function(){e.loading=!1})}))}}},o=a(0),s=Object(o.a)(r,n,[],!1,null,"08fb5ac1",null);s.options.__file="src/views/order/OrderList.vue";e.a=s.exports}}]);