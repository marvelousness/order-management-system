<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="org.marvelousness.springboot.oms.mapper.OrderDtoMapper">

	<resultMap type="org.marvelousness.springboot.oms.entity.dto.OrderDto" id="resultMap" extends="org.marvelousness.springboot.oms.mapper.OrderMapper.resultMap">
		<association column="creator_id" property="creator" select="org.marvelousness.springboot.oms.mapper.UserDtoMapper.selectByPrimaryKey" />
		<association column="executor_id" property="executor" select="org.marvelousness.springboot.oms.mapper.UserDtoMapper.selectByPrimaryKey" />
		<association column="customer_id" property="customer" select="org.marvelousness.springboot.oms.mapper.CustomerMapper.selectByPrimaryKey" />
	</resultMap>



	<sql id="table">`oms_order`</sql>
	<sql id="columns">`id`, `number`, `customer_id`, `creator_id`, `executor_id`, `amount`, `deal_time`, `create_time`, `remark`</sql>

	<!-- 根据主键查询单条数据 -->
	<select id="selectByPrimaryKey" resultMap="resultMap" useCache="false">
		SELECT
		<include refid="columns" />
		FROM
		<include refid="table" />
		<where>`id` = #{id} </where>
		LIMIT 1;
	</select>

	<!-- 查询列表 -->
	<select id="select" resultMap="resultMap" useCache="false">
		SELECT
		<include refid="columns" />
		FROM
		<include refid="table" />
		ORDER BY `create_time` DESC
		<if test="limit != null">
			<choose>
				<when test="offset != null and offset > -1">LIMIT #{offset}, #{limit}</when>
				<otherwise>LIMIT #{limit}</otherwise>
			</choose>
		</if>
	</select>

	<!-- 查询总数 -->
	<select id="count" resultType="java.lang.Long">
		SELECT COUNT(1) FROM
		<include refid="table" />
	</select>

</mapper>